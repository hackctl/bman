(()=>{"use strict";var e={16:(e,l,t)=>{t.d(l,{A:()=>c});var o=t(601),n=t.n(o),r=t(314),a=t.n(r)()(n());a.push([e.id,".module-card {\n    margin-bottom: 1rem;\n    border: 1px solid #dee2e6;\n    border-radius: 0.25rem;\n}\n\n.card-body {\n    padding: 1rem;\n}\n\n.module-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0.5rem 1rem;\n    background-color: #f8f9fa;\n    border-bottom: 1px solid #dee2e6;\n    cursor: pointer;\n}\n\n#modulesList {\n    max-height: 70vh;\n    overflow-y: auto;\n    padding-right: 1rem;\n}\n\n#modulesList::-webkit-scrollbar {\n    width: 8px;\n}\n\n#modulesList::-webkit-scrollbar-track {\n    background: #f1f1f1;\n    border-radius: 4px;\n}\n\n#modulesList::-webkit-scrollbar-thumb {\n    background: #888;\n    border-radius: 4px;\n}\n\n#modulesList::-webkit-scrollbar-thumb:hover {\n    background: #555;\n}\n\n.container {\n    max-width: 1200px;\n    margin: 0 auto;\n    padding: 2rem;\n}\n\n.col-md-6 {\n    height: calc(100vh - 4rem);\n    overflow-y: auto;\n    padding: 1rem;\n}\n\n.json-output {\n    font-family: monospace;\n    white-space: pre-wrap;\n    background-color: #f8f9fa;\n    padding: 1rem;\n    border: 1px solid #dee2e6;\n    border-radius: 0.25rem;\n    margin-top: 1rem;\n    max-height: calc(100vh - 8rem);\n    overflow-y: auto;\n}\n\n.form-label {\n    font-weight: 500;\n    margin-bottom: 0.5rem;\n}\n\n.form-control {\n    margin-bottom: 1rem;\n}\n\n.form-check {\n    margin-bottom: 0.5rem;\n}\n\n.btn-group {\n    margin-bottom: 1rem;\n}\n\n.stage2 {\n    display: none;\n}\n\n.probe-fields {\n    margin-top: 1rem;\n}\n\n.module-name-display {\n    font-weight: 500;\n    margin: 0;\n}\n\n.remove-module {\n    color: #dc3545;\n    cursor: pointer;\n}\n\n.remove-module:hover {\n    color: #bd2130;\n}\n\n.toggle-icon {\n    color: #6c757d;\n}\n\n.toggle-icon:hover {\n    color: #495057;\n} ",""]);const c=a},56:(e,l,t)=>{e.exports=function(e){var l=t.nc;l&&e.setAttribute("nonce",l)}},72:e=>{var l=[];function t(e){for(var t=-1,o=0;o<l.length;o++)if(l[o].identifier===e){t=o;break}return t}function o(e,o){for(var r={},a=[],c=0;c<e.length;c++){var s=e[c],i=o.base?s[0]+o.base:s[0],d=r[i]||0,u="".concat(i," ").concat(d);r[i]=d+1;var p=t(u),f={css:s[1],media:s[2],sourceMap:s[3],supports:s[4],layer:s[5]};if(-1!==p)l[p].references++,l[p].updater(f);else{var m=n(f,o);o.byIndex=c,l.splice(c,0,{identifier:u,updater:m,references:1})}a.push(u)}return a}function n(e,l){var t=l.domAPI(l);return t.update(e),function(l){if(l){if(l.css===e.css&&l.media===e.media&&l.sourceMap===e.sourceMap&&l.supports===e.supports&&l.layer===e.layer)return;t.update(e=l)}else t.remove()}}e.exports=function(e,n){var r=o(e=e||[],n=n||{});return function(e){e=e||[];for(var a=0;a<r.length;a++){var c=t(r[a]);l[c].references--}for(var s=o(e,n),i=0;i<r.length;i++){var d=t(r[i]);0===l[d].references&&(l[d].updater(),l.splice(d,1))}r=s}}},113:e=>{e.exports=function(e,l){if(l.styleSheet)l.styleSheet.cssText=e;else{for(;l.firstChild;)l.removeChild(l.firstChild);l.appendChild(document.createTextNode(e))}}},314:e=>{e.exports=function(e){var l=[];return l.toString=function(){return this.map((function(l){var t="",o=void 0!==l[5];return l[4]&&(t+="@supports (".concat(l[4],") {")),l[2]&&(t+="@media ".concat(l[2]," {")),o&&(t+="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {")),t+=e(l),o&&(t+="}"),l[2]&&(t+="}"),l[4]&&(t+="}"),t})).join("")},l.i=function(e,t,o,n,r){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(o)for(var c=0;c<this.length;c++){var s=this[c][0];null!=s&&(a[s]=!0)}for(var i=0;i<e.length;i++){var d=[].concat(e[i]);o&&a[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),t&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=t):d[2]=t),n&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=n):d[4]="".concat(n)),l.push(d))}},l}},535:(e,l,t)=>{var o=t(72),n=t.n(o),r=t(825),a=t.n(r),c=t(659),s=t.n(c),i=t(56),d=t.n(i),u=t(540),p=t.n(u),f=t(113),m=t.n(f),b=t(16),v={};v.styleTagTransform=m(),v.setAttributes=d(),v.insert=s().bind(null,"head"),v.domAPI=a(),v.insertStyleElement=p(),n()(b.A,v),b.A&&b.A.locals&&b.A.locals},540:e=>{e.exports=function(e){var l=document.createElement("style");return e.setAttributes(l,e.attributes),e.insert(l,e.options),l}},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var l={};e.exports=function(e,t){var o=function(e){if(void 0===l[e]){var t=document.querySelector(e);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(e){t=null}l[e]=t}return l[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var l=e.insertStyleElement(e);return{update:function(t){!function(e,l,t){var o="";t.supports&&(o+="@supports (".concat(t.supports,") {")),t.media&&(o+="@media ".concat(t.media," {"));var n=void 0!==t.layer;n&&(o+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),o+=t.css,n&&(o+="}"),t.media&&(o+="}"),t.supports&&(o+="}");var r=t.sourceMap;r&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),l.styleTagTransform(o,e,l.options)}(l,e,t)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(l)}}}}},l={};function t(o){var n=l[o];if(void 0!==n)return n.exports;var r=l[o]={id:o,exports:{}};return e[o](r,r.exports,t),r.exports}t.n=e=>{var l=e&&e.__esModule?()=>e.default:()=>e;return t.d(l,{a:l}),l},t.d=(e,l)=>{for(var o in l)t.o(l,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:l[o]})},t.o=(e,l)=>Object.prototype.hasOwnProperty.call(e,l),t.nc=void 0,t(535);let o=0;const n={},r={http:"\n        <div class='mb-3'>\n            <label class='form-label'>Timeout (seconds)</label>\n            <input type='text' class='form-control timeout' value='5s' pattern='^[1-9][0-9]*s$' placeholder='5s'>\n        </div>\n        <div class='mb-3'>\n            <label class='form-label'>HTTP Method</label>\n            <select class='form-control http-method' required onchange=\"togglePostFields(this)\">\n                <option value='GET'>GET</option>\n                <option value='POST'>POST</option>\n                <option value='PUT'>PUT</option>\n                <option value='DELETE'>DELETE</option>\n            </select>\n        </div>\n        <div class='post-fields' style='display: none;'>\n            <div class='mb-3'>\n                <label class='form-label'>Content Type</label>\n                <select class='form-control content-type'>\n                    <option value='application/json'>application/json</option>\n                    <option value='application/x-www-form-urlencoded'>application/x-www-form-urlencoded</option>\n                    <option value='text/plain'>text/plain</option>\n                </select>\n            </div>\n            <div class='mb-3'>\n                <label class='form-label'>Request Body</label>\n                <textarea class='form-control request-body' rows='4' placeholder='{\"key\": \"value\"}'></textarea>\n            </div>\n        </div>\n        <div class='mb-3'>\n            <label class='form-label'>Valid Status Codes (comma-separated)</label>\n            <input type='text' class='form-control valid-status-codes' placeholder='200,201,204' required>\n        </div>\n        <div class='mb-3'>\n            <label class='form-label'>Valid HTTP Versions</label>\n            <div class='form-check'>\n                <input class='form-check-input http-version' type='checkbox' value='HTTP/1.0'>\n                <label class='form-check-label'>HTTP/1.0</label>\n            </div>\n            <div class='form-check'>\n                <input class='form-check-input http-version' type='checkbox' value='HTTP/1.1' checked>\n                <label class='form-check-label'>HTTP/1.1</label>\n            </div>\n            <div class='form-check'>\n                <input class='form-check-input http-version' type='checkbox' value='HTTP/2.0'>\n                <label class='form-check-label'>HTTP/2.0</label>\n            </div>\n            <div class='form-check'>\n                <input class='form-check-input http-version' type='checkbox' value='HTTP/3.0'>\n                <label class='form-check-label'>HTTP/3.0</label>\n            </div>\n        </div>\n        <div class='mb-3'>\n            <label class='form-label'>Headers (one per line, format: key: value)</label>\n            <textarea class='form-control headers' rows='3' placeholder='User-Agent: Blackbox&#10;Accept: application/json'></textarea>\n        </div>\n        <div class='mb-3'>\n            <label class='form-label'>Fail if Body Matches (one per line)</label>\n            <textarea class='form-control fail-if-body-matches' rows='2' placeholder='error&#10;503 Service Unavailable'></textarea>\n        </div>\n        <div class='mb-3'>\n            <label class='form-label'>Fail if Body Not Matches (one per line)</label>\n            <textarea class='form-control fail-if-body-not-matches' rows='2'></textarea>\n        </div>\n        <div class='mb-3'>\n            <div class='form-check'>\n                <input class='form-check-input fail-if-ssl' type='checkbox'>\n                <label class='form-check-label'>Fail if SSL/TLS is used</label>\n            </div>\n        </div>\n        <div class='mb-3'>\n            <div class='form-check'>\n                <input class='form-check-input fail-if-not-ssl' type='checkbox'>\n                <label class='form-check-label'>Fail if SSL/TLS is not used</label>\n            </div>\n        </div>\n        <div class='mb-3'>\n            <label class='form-label'>Preferred IP Protocol</label>\n            <select class='form-control preferred-ip-protocol'>\n                <option value='ip4'>IPv4</option>\n                <option value='ip6'>IPv6</option>\n            </select>\n        </div>\n        <div class='mb-3'>\n            <div class='form-check'>\n                <input class='form-check-input ip-protocol-fallback' type='checkbox' checked>\n                <label class='form-check-label'>Try fallback IP protocol if preferred fails</label>\n            </div>\n        </div>\n        <div class='mb-3'>\n            <div class='form-check'>\n                <input class='form-check-input no-follow-redirects' type='checkbox'>\n                <label class='form-check-label'>Don't follow HTTP redirects</label>\n            </div>\n        </div>\n        <div class='mb-3'>\n            <div class='form-check'>\n                <input class='form-check-input enable-tls' type='checkbox' onchange=\"toggleTlsConfig(this)\">\n                <label class='form-check-label'>Enable TLS Configuration</label>\n            </div>\n        </div>\n        <div class='tls-config' style='display: none;'>\n            <div class='mb-3'>\n                <label class='form-label'>CA File</label>\n                <input type='file' class='form-control tls-ca-file-upload' data-type='ca'>\n            </div>\n            <div class='mb-3'>\n                <label class='form-label'>Certificate File</label>\n                <input type='file' class='form-control tls-cert-file-upload' data-type='cert'>\n            </div>\n            <div class='mb-3'>\n                <label class='form-label'>Key File</label>\n                <input type='file' class='form-control tls-key-file-upload' data-type='key'>\n            </div>\n            <div class='mb-3'>\n                <label class='form-label'>Server Name</label>\n                <input type='text' class='form-control tls-server-name' placeholder='my.api.server.com'>\n            </div>\n        </div>\n    ",tcp:"\n        <div class='mb-3'>\n            <label class='form-label'>Timeout (seconds)</label>\n            <input type='text' class='form-control timeout' value='5s' pattern='^[1-9][0-9]*s$' placeholder='5s'>\n        </div>\n        <div class='mb-3'>\n            <label class='form-label'>Preferred IP Protocol</label>\n            <select class='form-control preferred-ip-protocol'>\n                <option value='ip4'>IPv4</option>\n                <option value='ip6'>IPv6</option>\n            </select>\n        </div>\n        <div class='mb-3'>\n            <div class='form-check'>\n                <input class='form-check-input ip-protocol-fallback' type='checkbox' checked>\n                <label class='form-check-label'>Try fallback IP protocol if preferred fails</label>\n            </div>\n        </div>\n        <div class='mb-3'>\n            <div class='form-check'>\n                <input class='form-check-input enable-tls' type='checkbox' onchange=\"toggleTlsConfig(this)\">\n                <label class='form-check-label'>Enable TLS Configuration</label>\n            </div>\n        </div>\n        <div class='tls-config' style='display: none;'>\n            <div class='mb-3'>\n                <label class='form-label'>CA File</label>\n                <input type='file' class='form-control tls-ca-file-upload' data-type='ca'>\n            </div>\n            <div class='mb-3'>\n                <label class='form-label'>Certificate File</label>\n                <input type='file' class='form-control tls-cert-file-upload' data-type='cert'>\n            </div>\n            <div class='mb-3'>\n                <label class='form-label'>Key File</label>\n                <input type='file' class='form-control tls-key-file-upload' data-type='key'>\n            </div>\n            <div class='mb-3'>\n                <label class='form-label'>Server Name</label>\n                <input type='text' class='form-control tls-server-name' placeholder='my.api.server.com'>\n            </div>\n        </div>\n    ",ping:"\n        <div class='mb-3'>\n            <label class='form-label'>Timeout (seconds)</label>\n            <input type='text' class='form-control timeout' value='5s' pattern='^[1-9][0-9]*s$' placeholder='5s'>\n        </div>\n        <div class='mb-3'>\n            <label class='form-label'>Host</label>\n            <input type='text' class='form-control ping-host' placeholder='example.com' required>\n        </div>\n        <div class='mb-3'>\n            <label class='form-label'>Number of Packets</label>\n            <input type='number' class='form-control packet-count' value='4' min='1' max='10'>\n        </div>\n        <div class='mb-3'>\n            <div class='form-check'>\n                <input class='form-check-input enable-tls' type='checkbox' onchange=\"toggleTlsConfig(this)\">\n                <label class='form-check-label'>Enable TLS Configuration</label>\n            </div>\n        </div>\n        <div class='tls-config' style='display: none;'>\n            <div class='mb-3'>\n                <label class='form-label'>CA File</label>\n                <input type='file' class='form-control tls-ca-file-upload' data-type='ca'>\n            </div>\n            <div class='mb-3'>\n                <label class='form-label'>Certificate File</label>\n                <input type='file' class='form-control tls-cert-file-upload' data-type='cert'>\n            </div>\n            <div class='mb-3'>\n                <label class='form-label'>Key File</label>\n                <input type='file' class='form-control tls-key-file-upload' data-type='key'>\n            </div>\n            <div class='mb-3'>\n                <label class='form-label'>Server Name</label>\n                <input type='text' class='form-control tls-server-name' placeholder='my.api.server.com'>\n            </div>\n        </div>\n    "};function a(){const e=generateConfigObject(),l=jsyaml.dump(e,{indent:2,lineWidth:-1,noRefs:!0,sortKeys:!1});document.getElementById("configOutput").textContent=l}function c(e){const l=e.querySelector(".module-name").value||"default_module";n[l]||(n[l]={}),e.querySelectorAll('.tls-config input[type="file"]').forEach((e=>{e.addEventListener("change",(function(){const e=this.files[0];if(!e)return;const t=this.getAttribute("data-type"),o=new FormData;o.append("file",e),fetch(`/api/upload-tls-file?module=${encodeURIComponent(l)}&type=${encodeURIComponent(t)}`,{method:"POST",body:o}).then((e=>e.json())).then((o=>{o.success?(n[l][t]=e.name,alert("TLS file uploaded successfully."),a()):alert("Failed to upload TLS file: "+o.error)})).catch((e=>{alert("Error uploading TLS file: "+e.message)}))}))}))}window.addNewModule=function(){const e=document.getElementById("moduleTemplate").content.cloneNode(!0);document.getElementById("modulesList").appendChild(e);const l=document.querySelector(".module-card:last-child");setupModuleEventListeners(l),a()},window.setupModuleEventListeners=function(e){const l=e.querySelector(".module-form");l.querySelector(".next-stage").addEventListener("click",(function(){const e=l.querySelector(".module-type").value;e?(l.querySelector(".stage1").style.display="none",l.querySelector(".stage2").style.display="block",l.querySelector(".probe-fields").innerHTML=r[e]||"",a()):alert("Please select a module type")})),l.querySelector(".prev-stage").addEventListener("click",(function(){l.querySelector(".stage2").style.display="none",l.querySelector(".stage1").style.display="block",a()})),l.addEventListener("input",a),l.addEventListener("change",a),c(e)},window.removeModule=function(e){const l=e.closest(".module-card"),t=l.querySelector(".enable-tls"),o=l.querySelector(".module-name").value||"default_module";t&&t.checked&&fetch(`/api/delete-tls-folder?module=${encodeURIComponent(o)}`).then((e=>e.json())).then((e=>{e.success||alert("Failed to delete TLS folder: "+e.error)})).catch((e=>{alert("Error deleting TLS folder: "+e.message)})),l.remove(),a()},window.handleModuleTypeChange=function(e){const l=e.closest(".module-card").querySelector(".probe-fields");l.innerHTML=l[e.value]||"",a()},window.togglePostFields=function(e){e.closest(".module-card").querySelector(".post-fields").style.display="POST"===e.value||"PUT"===e.value?"block":"none",a()},window.toggleTlsConfig=function(e){const l=e.closest(".module-card");l.querySelector(".tls-config").style.display=e.checked?"block":"none",a();const t=l.querySelector(".module-name").value||"default_module";e.checked?(fetch(`/api/create-tls-folder?module=${encodeURIComponent(t)}`).then((e=>e.json())).then((e=>{e.success||alert("Failed to create TLS folder: "+e.error)})).catch((e=>{alert("Error creating TLS folder: "+e.message)})),c(l)):(fetch(`/api/delete-tls-folder?module=${encodeURIComponent(t)}`).then((e=>e.json())).then((e=>{e.success||alert("Failed to delete TLS folder: "+e.error)})).catch((e=>{alert("Error deleting TLS folder: "+e.message)})),n[t]&&delete n[t],a())},window.toggleModuleConfig=function(e){const l=e.closest(".module-card"),t=l.querySelector(".card-body"),o=e.querySelector("i");"none"===t.style.display?(t.style.display="block",l.style.marginBottom="1rem",o.classList.remove("bi-chevron-down"),o.classList.add("bi-chevron-up")):(t.style.display="none",l.style.marginBottom="0.5rem",o.classList.remove("bi-chevron-up"),o.classList.add("bi-chevron-down"))},window.updateModuleDisplay=function(e){e.closest(".module-card").querySelector(".module-name-display").textContent=e.value||"Module"},window.generateConfigObject=function(){const e={modules:{}};return document.querySelectorAll(".module-card").forEach((l=>{const t=l.querySelector(".module-form"),r=t.querySelector(".module-name").value||"module_"+o++;e.modules[r]={prober:t.querySelector(".module-type").value,timeout:t.querySelector(".timeout")?.value||"5s",[t.querySelector(".module-type").value]:{}};const a=t.querySelector(".module-type").value;if("http"===a){const l=e.modules[r].http;l.method=t.querySelector(".http-method").value;const o=t.querySelector(".valid-status-codes").value.split(",").map((e=>parseInt(e.trim()))).filter((e=>!isNaN(e)));if(l.valid_status_codes=o.length>0?o:[200],t.querySelector(".enable-tls").checked){const e=t.querySelector(".tls-server-name"),o=e?e.value:"";l.tls=!0;const a=n[r]?.ca||"ca.pem",c=n[r]?.cert||"client.pem",s=n[r]?.key||"client.key";l.tls_config={ca_file:`/blackbox/tls/${r}/${a}`,cert_file:`/blackbox/tls/${r}/${c}`,key_file:`/blackbox/tls/${r}/${s}`,server_name:o}}const a={};if(t.querySelector(".headers").value.split("\n").forEach((e=>{const[l,t]=e.split(":").map((e=>e.trim()));l&&t&&(a[l]=t)})),Object.keys(a).length>0&&(l.headers=a),"POST"===l.method||"PUT"===l.method){const e=t.querySelector(".content-type").value;e&&(l.headers||(l.headers={}),l.headers["Content-Type"]=e);const o=t.querySelector(".request-body").value;o&&(l.body=o)}const c=Array.from(t.querySelectorAll(".http-version:checked")).map((e=>e.value));c.length>0&&(l.valid_http_versions=c);const s=t.querySelector(".fail-if-body-matches").value.split("\n").filter((e=>e.trim()));s.length>0&&(l.fail_if_body_matches_regexp=s);const i=t.querySelector(".fail-if-body-not-matches").value.split("\n").filter((e=>e.trim()));i.length>0&&(l.fail_if_body_not_matches_regexp=i),t.querySelector(".fail-if-ssl").checked&&(l.fail_if_ssl=!0),t.querySelector(".fail-if-not-ssl").checked&&(l.fail_if_not_ssl=!0);const d=t.querySelector(".preferred-ip-protocol").value;d&&(l.preferred_ip_protocol=d),t.querySelector(".ip-protocol-fallback").checked&&(l.ip_protocol_fallback=!0),t.querySelector(".no-follow-redirects").checked&&(l.no_follow_redirects=!0)}else if("tcp"===a){const l=e.modules[r].tcp,o=t.querySelector(".preferred-ip-protocol").value;if(o&&(l.preferred_ip_protocol=o),t.querySelector(".ip-protocol-fallback").checked&&(l.ip_protocol_fallback=!0),t.querySelector(".enable-tls").checked){const e=t.querySelector(".tls-server-name"),o=e?e.value:"";l.tls=!0;const a=n[r]?.ca||"ca.pem",c=n[r]?.cert||"client.pem",s=n[r]?.key||"client.key";l.tls_config={ca_file:`/blackbox/tls/${r}/${a}`,cert_file:`/blackbox/tls/${r}/${c}`,key_file:`/blackbox/tls/${r}/${s}`,server_name:o}}}else if("ping"===a){const l=e.modules[r].ping;if(l.host=t.querySelector(".ping-host").value,l.packet_count=parseInt(t.querySelector(".packet-count").value),t.querySelector(".enable-tls").checked){const e=t.querySelector(".tls-server-name"),o=e?e.value:"";l.tls=!0;const a=n[r]?.ca||"ca.pem",c=n[r]?.cert||"client.pem",s=n[r]?.key||"client.key";l.tls_config={ca_file:`/blackbox/tls/${r}/${a}`,cert_file:`/blackbox/tls/${r}/${c}`,key_file:`/blackbox/tls/${r}/${s}`,server_name:o}}}})),e},window.downloadConfig=function(){try{const e=generateConfigObject(),l=jsyaml.dump(e,{indent:2,lineWidth:-1,noRefs:!0,sortKeys:!1}),t=`${Object.keys(e.modules)[0]||"config"}.yml`,o=new Blob([l],{type:"text/yaml"}),n=window.URL.createObjectURL(o),r=document.createElement("a");r.href=n,r.download=t,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(n),document.body.removeChild(r)}catch(e){console.error("Error downloading config:",e),alert("Failed to download configuration. Please try again.")}},window.handleFileUpload=function(e){const l=e.files[0];if(!l)return;const t=new FileReader;t.onload=function(l){try{const t=l.target.result;console.log("File content:",t);const o=jsyaml.load(t);if(console.log("Parsed config:",o),!o||"object"!=typeof o)throw new Error("Invalid configuration format: must be an object");if(!o.modules||"object"!=typeof o.modules)throw new Error("Invalid configuration: missing or invalid modules section");const n=jsyaml.dump(o,{indent:2,lineWidth:-1,noRefs:!0,sortKeys:!1});document.getElementById("configOutput").textContent=n,updateFormFromConfig(o),e.value=""}catch(e){console.error("Error details:",{message:e.message,stack:e.stack,name:e.name}),alert(`Error loading configuration: ${e.message}`)}},t.onerror=function(e){console.error("File reading error:",e),alert("Error reading the file. Please try again.")},t.readAsText(l)},window.updateFormFromConfig=function(e){const l=document.getElementById("modulesList");l.innerHTML="",e.modules&&Object.entries(e.modules).forEach((([e,t])=>{window.addNewModule();const o=l.lastElementChild;if(!o)return;const n=o.querySelector(".module-form");if(!n)return;const r=n.querySelector(".module-name"),a=n.querySelector(".module-type");r&&(r.value=e),a&&(a.value=t.prober,a.dispatchEvent(new Event("change")));const c=n.querySelector(".next-stage");c&&c.click();const s=t.prober;if("http"===s){const e=t.http;if(e){const l=n.querySelector(".timeout"),o=n.querySelector(".http-method"),r=n.querySelector(".valid-status-codes");if(l&&(l.value=t.timeout||"5s"),o&&(o.value=e.method||"GET"),r){let l=e.valid_status_codes;"number"==typeof l&&(l=[l]),r.value=l?.join(",")||""}if(e.headers){const l=n.querySelector(".headers");if(l){const t=Object.entries(e.headers).map((([e,l])=>`${e}: ${l}`)).join("\n");l.value=t}}if("POST"===e.method||"PUT"===e.method){const l=n.querySelector(".content-type"),t=n.querySelector(".request-body");l&&(l.value=e.headers?.["Content-Type"]||"application/json"),t&&(t.value=e.body||"")}e.valid_http_versions&&n.querySelectorAll(".http-version").forEach((l=>{l.checked=e.valid_http_versions.includes(l.value)}));const a=n.querySelector(".fail-if-body-matches"),c=n.querySelector(".fail-if-body-not-matches"),s=n.querySelector(".fail-if-ssl"),i=n.querySelector(".fail-if-not-ssl");a&&e.fail_if_body_matches_regexp&&(a.value=e.fail_if_body_matches_regexp.join("\n")),c&&e.fail_if_body_not_matches_regexp&&(c.value=e.fail_if_body_not_matches_regexp.join("\n")),s&&(s.checked=e.fail_if_ssl||!1),i&&(i.checked=e.fail_if_not_ssl||!1);const d=n.querySelector(".preferred-ip-protocol"),u=n.querySelector(".ip-protocol-fallback");d&&(d.value=e.preferred_ip_protocol||"ip4"),u&&(u.checked=e.ip_protocol_fallback||!1);const p=n.querySelector(".no-follow-redirects");p&&(p.checked=e.no_follow_redirects||!1)}}else if("tcp"===s){const e=t.tcp;if(e){const l=n.querySelector(".timeout"),o=n.querySelector(".preferred-ip-protocol"),r=n.querySelector(".ip-protocol-fallback");l&&(l.value=t.timeout||"5s"),o&&(o.value=e.preferred_ip_protocol||"ip4"),r&&(r.checked=e.ip_protocol_fallback||!1)}}else if("ping"===s){const e=t.ping;if(e){const l=n.querySelector(".timeout"),o=n.querySelector(".ping-host"),r=n.querySelector(".packet-count");l&&(l.value=t.timeout||"5s"),o&&(o.value=e.host||""),r&&(r.value=e.packet_count||4)}}r&&r.dispatchEvent(new Event("input"))}))}})();