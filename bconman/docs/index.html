<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Blackbox Module Config Manager</title><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet"><link rel="stylesheet" href="/dist/styles.css"><style>.module-card{margin-bottom:1rem;border:1px solid rgba(0,0,0,.125);border-radius:.25rem}.card-body{overflow:hidden;border-top:1px solid rgba(0,0,0,.125)}.module-header{user-select:none;cursor:pointer;padding:.75rem 1rem;background-color:#f8f9fa;display:flex;justify-content:space-between;align-items:center}#modulesList{max-height:calc(100vh - 200px);overflow-y:auto;padding-right:10px;padding-bottom:1rem}#modulesList::-webkit-scrollbar{width:8px}#modulesList::-webkit-scrollbar-track{background:#f1f1f1;border-radius:4px}#modulesList::-webkit-scrollbar-thumb{background:#888;border-radius:4px}#modulesList::-webkit-scrollbar-thumb:hover{background:#555}.col-md-6{height:calc(100vh - 100px);display:flex;flex-direction:column}.col-md-6 .card{height:100%;display:flex;flex-direction:column}.col-md-6 .card-body{flex:1;overflow:hidden;display:flex;flex-direction:column}#modulesList{flex:1;overflow-y:auto}.module-card .card-body[style*="display: none"]{margin:0;padding:0;height:0;border:none}.module-card .card-body[style*="display: none"]+.module-header{margin-bottom:0}.module-card .card-body[style*="display: none"]~.module-card{margin-top:.5rem}.module-card:not(:last-child){margin-bottom:1rem}.module-card:last-child{margin-bottom:0}</style><script defer="defer" src="main.js"></script><script defer="defer" src="styles.js"></script></head><body><div class="container"><h1 class="text-center mb-4">Blackbox Module Config Manager</h1><div class="row"><div class="col-md-6"><div class="d-flex justify-content-between align-items-center mb-3"><h2>Modules</h2><div><label for="configFile" class="btn btn-primary me-2"><i class="bi bi-upload"></i> Upload Config <input type="file" id="configFile" accept=".yml,.yaml" style="display:none" onchange="handleFileUpload(this)"></label> <button class="btn btn-primary" onclick="addNewModule()"><i class="bi bi-plus-lg"></i> Add Module</button></div></div><div id="modulesList"></div></div><div class="col-md-6"><div class="d-flex justify-content-between align-items-center mb-3"><h2>Configuration Output</h2><div><button class="btn btn-success me-2" onclick="saveConfig()"><i class="bi bi-save"></i> Save</button> <button class="btn btn-warning" onclick="reloadConfig()"><i class="bi bi-arrow-repeat"></i> Reload</button></div></div><div id="configOutput" class="json-output" contenteditable="true" spellcheck="false"></div></div></div></div><template id="moduleTemplate"><div class="module-card"><div class="module-header" onclick="toggleModuleConfig(this)"><h3 class="module-name-display">Module</h3><div><i class="bi bi-chevron-up toggle-icon"></i> <i class="bi bi-x-lg remove-module ms-2" onclick="removeModule(this)"></i></div></div><div class="card-body"><form class="module-form"><div class="stage1"><div class="mb-3"><label class="form-label">Module Name</label> <input class="form-control module-name" oninput="updateModuleDisplay(this)" placeholder="Enter module name"></div><div class="mb-3"><label class="form-label">Module Type</label> <select class="form-control module-type" onchange="handleModuleTypeChange(this)" required><option value="">Select module type</option><option value="http">HTTP</option><option value="tcp">TCP</option><option value="ping">Ping</option></select></div><div class="d-flex justify-content-end"><button type="button" class="btn btn-primary next-stage">Next</button></div></div><div class="stage2"><div class="probe-fields"></div><div class="d-flex justify-content-between"><button type="button" class="btn btn-secondary prev-stage">Back</button></div></div></form></div></div></template><script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script><script src="/dist/main.js"></script><script>let defaultConfig=null;async function loadDefaultConfig(){try{const e=await fetch("/api/defaults");if(e.ok){defaultConfig=await e.json(),console.log("Loaded default config:",defaultConfig);const o=jsyaml.dump(defaultConfig,{indent:2,lineWidth:-1,noRefs:!0,sortKeys:!1});document.getElementById("configOutput").textContent=o,populateFormWithDefaults()}else console.warn("Failed to load default configuration")}catch(e){console.error("Error loading default configuration:",e)}}function populateFormWithDefaults(){if(!defaultConfig||!defaultConfig.modules)return;const e=document.getElementById("modulesList");e.innerHTML="",Object.entries(defaultConfig.modules).forEach((([o,t])=>{window.addNewModule();const r=e.lastElementChild;if(!r)return;const n=r.querySelector(".module-form");if(!n)return;const l=n.querySelector(".module-name"),a=n.querySelector(".module-type");l&&(l.value=o),a&&(a.value=t.prober,a.dispatchEvent(new Event("change")));const i=n.querySelector(".next-stage");i&&i.click();const c=t.prober;if("http"===c){const e=t.http;if(e){const o=n.querySelector(".timeout"),r=n.querySelector(".http-method"),l=n.querySelector(".valid-status-codes");if(o&&(o.value=t.timeout||"5s"),r&&(r.value=e.method||"GET"),l){let o=e.valid_status_codes;"number"==typeof o&&(o=[o]),l.value=o?.join(",")||""}e.valid_http_versions&&n.querySelectorAll(".http-version").forEach((o=>{o.checked=e.valid_http_versions.includes(o.value)}));const a=n.querySelector(".preferred-ip-protocol"),i=n.querySelector(".ip-protocol-fallback");a&&(a.value=e.preferred_ip_protocol||"ip4"),i&&(i.checked=e.ip_protocol_fallback||!1);const c=n.querySelector(".no-follow-redirects"),s=n.querySelector(".fail-if-ssl"),u=n.querySelector(".fail-if-not-ssl");c&&(c.checked=e.no_follow_redirects||!1),s&&(s.checked=e.fail_if_ssl||!1),u&&(u.checked=e.fail_if_not_ssl||!1)}}else if("tcp"===c){const e=t.tcp;if(e){const o=n.querySelector(".timeout"),r=n.querySelector(".preferred-ip-protocol"),l=n.querySelector(".ip-protocol-fallback");o&&(o.value=t.timeout||"5s"),r&&(r.value=e.preferred_ip_protocol||"ip4"),l&&(l.checked=e.ip_protocol_fallback||!1)}}else if("ping"===c){const e=t.ping;if(e){const o=n.querySelector(".timeout"),r=n.querySelector(".packet-count");o&&(o.value=t.timeout||"5s"),r&&(r.value=e.packet_count||4)}}l&&l.dispatchEvent(new Event("input"))}))}async function saveConfig(){try{if("function"!=typeof window.generateConfigObject)throw new Error("Configuration generator not loaded");const e=window.generateConfigObject(),o=await fetch("/api/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!o.ok){const e=await o.json();throw new Error(e.error||"Failed to save configuration")}{const e=await o.json();if(!e.success)throw new Error(e.error||"Failed to save configuration");alert("Configuration saved successfully to blackbox_config.yml"),await reloadConfig()}}catch(e){console.error("Error:",e),alert("Failed to save configuration: "+e.message)}}async function reloadConfig(){try{const e=await fetch("/api/reload",{method:"POST"}),o=await e.json();e.ok&&o.success?alert("Blackbox exporter reloaded successfully."):alert("Failed to reload exporter: "+(o.details||o.error||"Unknown error"))}catch(e){alert("Error reloading exporter: "+e.message)}}document.addEventListener("DOMContentLoaded",(function(){loadDefaultConfig()}))</script></body></html>